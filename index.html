<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aces of Valor - Tactical Console</title>
    <style>
        :root { --paper: #f0e6d2; --ink: #3b2f21; --army: #4b5320; --danger: #8b0000; --gold: #d4af37; --air: #268bd2; }
        body { background: #1a1a1a; color: var(--ink); font-family: 'Courier New', Courier, monospace; margin: 0; padding: 10px; }
        .container { max-width: 900px; margin: auto; background: var(--paper); border: 8px double var(--ink); padding: 20px; min-height: 95vh; box-shadow: 0 0 20px black; }
        
        h1, h2, h3 { text-align: center; text-transform: uppercase; border-bottom: 2px solid var(--ink); margin: 10px 0; }
        
        .tabs { display: flex; gap: 2px; margin-bottom: 15px; background: var(--ink); padding: 2px; }
        .tab { flex: 1; background: var(--army); color: white; border: none; padding: 12px; cursor: pointer; font-weight: bold; text-transform: uppercase; font-size: 0.8em; }
        .tab.active { background: var(--paper); color: var(--ink); }

        .panel { display: none; }
        .panel.active { display: block; }

        /* Roster Grid */
        .pilot-grid { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .pilot-grid th, .pilot-grid td { border: 1px solid var(--ink); padding: 8px; text-align: center; }
        .ace { color: var(--danger); font-weight: bold; }

        /* Combat Layout */
        .combat-cols { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .card { border: 1px solid var(--ink); padding: 10px; background: rgba(0,0,0,0.05); margin-bottom: 10px; }
        
        .btn { width: 100%; padding: 10px; cursor: pointer; border: none; font-weight: bold; color: white; margin-top: 5px; }
        .btn-roll { background: var(--danger); }
        .btn-setup { background: var(--army); }
        
        select, input { width: 100%; padding: 8px; box-sizing: border-box; border: 1px solid var(--ink); font-family: inherit; }
        .res-box { background: white; padding: 10px; border: 1px dashed var(--ink); margin-top: 10px; min-height: 50px; font-size: 0.9em; }
        .log { font-size: 0.75em; height: 120px; overflow-y: auto; background: #eee; padding: 5px; border: 1px solid #ccc; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1>Aces of Valor - Tactical Console</h1>

    <div class="tabs">
        <button class="tab active" onclick="openTab('setup')">Setup</button>
        <button class="tab" onclick="openTab('roster')">Squadriglia</button>
        <button class="tab" onclick="openTab('combat')">Combattimento</button>
    </div>

    <div id="setup" class="panel active">
        <div class="card">
            <h3>Preparazione Campagna</h3>
            <label>Nazione:</label>
            <select id="nation">
                <option value="GER">Germania</option>
                <option value="UK">Gran Bretagna</option>
                <option value="FR">Francia</option>
                <option value="US">USA</option>
            </select>
            <button class="btn btn-setup" onclick="rollS1()">Roll S1: Assegna Aerei</button>
            <button class="btn btn-setup" onclick="rollS2()">Roll S2: Aeroporto Base</button>
            <div id="setup-res" class="res-box">Configura la tua squadriglia...</div>
        </div>
        <div class="card">
            <h3>Meteo (M1)</h3>
            <button class="btn btn-setup" style="background:#555" onclick="rollMeteo()">Tira Meteo del Giorno</button>
            <div id="meteo-res" class="res-box">-</div>
        </div>
    </div>

    <div id="roster" class="panel">
        <h3>Roster Piloti</h3>
        <button class="btn btn-setup" onclick="generateSquadron()">Genera 8 Piloti Iniziali</button>
        <table class="pilot-grid">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Air</th>
                    <th>Gnd</th>
                    <th>Kill</th>
                    <th>Azione</th>
                </tr>
            </thead>
            <tbody id="pilot-list"></tbody>
        </table>
    </div>

    <div id="combat" class="panel">
        <div class="combat-cols">
            <div class="card">
                <h3 style="color:var(--air)">Aria-Aria (C7/C8)</h3>
                <label>Pilota:</label>
                <select id="sel-air-pilot"></select>
                <label>Diff. Iniziativa (Att-Dif):</label>
                <input type="number" id="air-in" value="2">
                <label>Bersaglio:</label>
                <select id="air-target">
                    <option value="5">Caccia (Struct 5)</option>
                    <option value="6">2-Seater (Struct 6)</option>
                    <option value="7">Bombardiere (Struct 7)</option>
                </select>
                <button class="btn btn-roll" onclick="solveAir()">FUOCO!</button>
            </div>
            <div class="card">
                <h3 style="color:var(--army)">Aria-Terra (C11)</h3>
                <label>Pilota:</label>
                <select id="sel-gnd-pilot"></select>
                <label>IN Difference:</label>
                <input type="number" id="gnd-in" value="6">
                <label>Obiettivo:</label>
                <select id="gnd-target">
                    <option value="4">Fanteria (4+)</option>
                    <option value="5">Trincea/Art (5+)</option>
                </select>
                <button class="btn btn-roll" style="background:var(--army)" onclick="solveGround()">STRAFING!</button>
            </div>
        </div>
        <div id="combat-res" class="res-box">Risultato scontro...</div>
        <div id="combat-log" class="log"></div>
    </div>
</div>

<script>
    let squadron = [];
    
    function openTab(id) {
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
        if(id === 'combat') updateSelects();
    }

    // --- SETUP ---
    function rollS1() {
        const d = Math.floor(Math.random()*6)+1;
        const n = document.getElementById('nation').value;
        let p = "";
        if(d<=2) p = {GER:"Albatros D.III", UK:"Sopwith Pup", FR:"Nieuport 17", US:"Nieuport 17"}[n];
        else if(d<=4) p = {GER:"Fokker Dr.I", UK:"Sopwith Camel", FR:"SPAD VII", US:"Nieuport 28"}[n];
        else p = {GER:"Fokker D.VII", UK:"Sopwith Dolphin", FR:"SPAD XIII", US:"SPAD XIII"}[n];
        document.getElementById('setup-res').innerHTML = `Tiro: ${d} | Squadriglia equipaggiata con: <b>${p}</b>`;
    }

    function rollS2() {
        const d = Math.floor(Math.random()*6)+1;
        const fields = ["Aeroporto A (Nord)", "Aeroporto A (Nord)", "Aeroporto B (Centro)", "Aeroporto B (Centro)", "Aeroporto C (Sud)", "Aeroporto C (Sud)"];
        document.getElementById('setup-res').innerHTML += `<br>Base Operativa: <b>${fields[d-1]}</b>`;
    }

    function rollMeteo() {
        const d = Math.floor(Math.random()*6)+1;
        const m = ["Sereno", "Sereno", "Nuvole Leggere (-1 Photo)", "Nuvole Leggere (-1 Photo)", "Nuvole Pesanti (-2 Photo)", "Nuvole Pesanti (-2 Photo)"];
        document.getElementById('meteo-res').innerText = `D6: ${d} - Risultato: ${m[d-1]}`;
    }

    // --- SQUADRON ---
    function generateSquadron() {
        squadron = [];
        const names = ["Baracca", "Richthofen", "Fonck", "Mannock", "Bishop", "Udet", "Ball", "Rickenbacker"];
        for(let i=0; i<8; i++) {
            const d = Math.floor(Math.random()*6)+1;
            let a=0, g=0;
            if(d===1) {a=0; g=0;} else if(d<=3) {a=1; g=0;} else if(d<=5) {a=0; g=1;} else {a=1; g=1;}
            squadron.push({ name: names[i], air: a, gnd: g, kills: 0, isAce: false });
        }
        renderRoster();
    }

    function renderRoster() {
        const body = document.getElementById('pilot-list');
        body.innerHTML = "";
        squadron.forEach((p, i) => {
            body.innerHTML += `
                <tr>
                    <td class="${p.isAce ? 'ace' : ''}">${p.isAce ? '★ ' : ''}${p.name}</td>
                    <td>${p.air}</td>
                    <td>${p.gnd}</td>
                    <td>${p.kills}</td>
                    <td><button onclick="addKill(${i})">+Kill</button></td>
                </tr>`;
        });
    }

    function addKill(i) {
        squadron[i].kills++;
        if(squadron[i].kills >= 5 && !squadron[i].isAce) {
            squadron[i].isAce = true;
            squadron[i].air += 1;
            alert(squadron[i].name + " è ora un ASSO!");
        }
        renderRoster();
    }

    function updateSelects() {
        const s1 = document.getElementById('sel-air-pilot');
        const s2 = document.getElementById('sel-gnd-pilot');
        const opts = squadron.map((p, i) => `<option value="${i}">${p.name} (A:${p.air}/G:${p.gnd})</option>`).join('');
        s1.innerHTML = s2.innerHTML = opts || "<option>Genera squadriglia!</option>";
    }

    // --- COMBAT ENGINE ---
    function solveAir() {
        const p = squadron[document.getElementById('sel-air-pilot').value];
        const diff = parseInt(document.getElementById('air-in').value);
        const struct = parseInt(document.getElementById('air-target').value);
        
        let dice = diff <= 2 ? 2 : diff <= 4 ? 3 : diff <= 7 ? 4 : 5;
        let hits = 0, rolls = [];
        
        for(let i=0; i<dice; i++) {
            let d = Math.floor(Math.random()*6)+1;
            rolls.push(d);
            if(d === 1) continue; 
            if((d + p.air) >= 5) hits++;
        }

        let msg = hits >= struct ? "DISTRUTTO!" : hits >= (struct-2) ? "DANNEGGIATO!" : "EFFETTO MINORE";
        displayCombat("ARIA-ARIA", p.name, rolls, hits, msg);
    }

    function solveGround() {
        const p = squadron[document.getElementById('sel-gnd-pilot').value];
        const diff = parseInt(document.getElementById('gnd-in').value);
        const dice = diff <= 5 ? 1 : diff <= 10 ? 2 : 3;
        
        let hits = 0, rolls = [];
        for(let i=0; i<dice; i++) {
            let d = Math.floor(Math.random()*6)+1;
            rolls.push(d);
            if(d > 1 && (d + p.gnd) >= 5) hits++;
        }
        
        let dmg = 0;
        for(let i=0; i<hits; i++) { if(Math.floor(Math.random()*6)+1 >= 3) dmg++; }
        
        displayCombat("ARIA-TERRA", p.name, rolls, hits, `Danni inflitti: ${dmg}`);
    }

    function displayCombat(mode, name, rolls, hits, msg) {
        const out = `[${mode}] <b>${name}</b> | Dadi: [${rolls.join(',')}] | Hits: ${hits} | <b>${msg}</b>`;
        document.getElementById('combat-res').innerHTML = out;
        document.getElementById('combat-log').innerHTML = `<div>${out}</div>` + document.getElementById('combat-log').innerHTML;
    }
</script>
</body>
</html>
